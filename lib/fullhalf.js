"use strict";
/**
 * Created by user on 2017/12/8/008.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const deepmerge = require("deepmerge");
const util = require("./util");
var FullHalfCore;
(function (FullHalfCore) {
    FullHalfCore.FULL_WIDTH = 1;
    FullHalfCore.HALF_WIDTH = 0;
    FullHalfCore.NO_EXIST = -1;
    /**
     * @see https://en.wikipedia.org/wiki/Code_page_437
     */
    let _table = {
        default: {
            from: 0x0020 + 1,
            to: 0x007F - 1,
            values: [0x0020],
        },
        number: [0x0030, 0x0039],
        'A-Z': [0x0041, 0x005A],
        'a-z': [0x0061, 0x007A],
        space: [0x0020],
        slash: {
            values: util.charCodeAt(`/\\`),
        },
        bracket: {
            values: util.charCodeAt(`()[]{}`),
        },
    };
    FullHalfCore.tableDefaultInclude = [
        'number',
        'A-Z',
        'a-z',
        'space',
        'not_default',
    ];
    FullHalfCore.table = [];
    {
        let _keys = FullHalfCore.tableDefaultInclude.slice(0, -1);
        FullHalfCore.table[0] = {};
        FullHalfCore.table[1] = {};
        for (let k in _table) {
            let v = _table[k];
            let r;
            r = fn(v);
            if (r) {
                FullHalfCore.table[FullHalfCore.HALF_WIDTH][k] = r[1];
                FullHalfCore.table[FullHalfCore.FULL_WIDTH][k] = r[0];
            }
        }
        let r = fn(_table.default);
        r[0].not = [];
        r[1].not = [];
        for (let k of _keys) {
            let v = _table[k];
            let r2;
            r2 = fn(v);
            if (r2) {
                r[0].not.push(r2[0]);
                r[1].not.push(r2[1]);
            }
        }
        FullHalfCore.table[FullHalfCore.HALF_WIDTH]['not_default'] = r[1];
        FullHalfCore.table[FullHalfCore.FULL_WIDTH]['not_default'] = r[0];
        //console.log(table);
        function fn(v) {
            let r = [];
            r[0] = {};
            r[1] = {};
            let _skip = true;
            if (Array.isArray(v)) {
                if (v.length == 2) {
                    r[0].from = v[0];
                    r[0].to = v[1];
                }
                else {
                    r[0].values = v;
                }
                _skip = false;
            }
            if (v.from && v.to) {
                r[0].from = v.from;
                r[0].to = v.to;
                _skip = false;
            }
            if (Array.isArray(v.values) && v.values.length) {
                r[0].values = v.values;
                _skip = false;
            }
            if (_skip) {
                return;
            }
            if (r[0].from && r[0].to) {
                r[1].from = toFullWidth(r[0].from);
                r[1].to = toFullWidth(r[0].to);
            }
            if (r[0].values) {
                r[1].values = r[0].values.reduce(function (a, code) {
                    a.push(toFullWidth(code));
                    return a;
                }, []);
            }
            return r;
        }
    }
    function filterTable(data) {
        let _a = [];
        if (data.from && data.to) {
            for (let i = data.from; i <= data.to; i++) {
                _a.push(i);
            }
        }
        if (data.values) {
            _a = _a.concat(data.values);
        }
        if (Array.isArray(data.not) && data.not.length) {
            _a = _a.filter(function (charCode) {
                for (let d of data.not) {
                    if (_chkType(charCode, d)) {
                        return false;
                    }
                }
                return true;
            });
        }
        return _a;
    }
    FullHalfCore.filterTable = filterTable;
    function _chkType(charCode, data) {
        if (data.from && data.to && data.from <= charCode && charCode <= data.to) {
            return true;
        }
        else if (data.values && data.values.includes(charCode)) {
            return true;
        }
    }
    FullHalfCore._chkType = _chkType;
    function chkType(charCode, key, type) {
        let data = FullHalfCore.table[type][key];
        //console.log(charCode, data);
        if (Array.isArray(data.not) && data.not.length) {
            for (let d of data.not) {
                if (_chkType(charCode, d)) {
                    return false;
                }
            }
        }
        if (_chkType(charCode, data)) {
            return true;
        }
    }
    FullHalfCore.chkType = chkType;
    function hasFullHalf(charCode) {
        if (0x0020 <= charCode && charCode < 0x007F) {
            return FullHalfCore.HALF_WIDTH;
        }
        if (0x3000 === charCode || 0xFF00 < charCode && charCode < 0xFF5F) {
            return FullHalfCore.FULL_WIDTH;
        }
        return FullHalfCore.NO_EXIST;
    }
    FullHalfCore.hasFullHalf = hasFullHalf;
    function isFullHalf(charCode) {
        let r = hasFullHalf(charCode);
        if (r === FullHalfCore.FULL_WIDTH) {
            return true;
        }
        else if (r === FullHalfCore.HALF_WIDTH) {
            return false;
        }
        else {
            // @todo add more...
        }
        return null;
    }
    FullHalfCore.isFullHalf = isFullHalf;
    function toFullWidth(charCode) {
        if (0x0020 < charCode && charCode < 0x007F) {
            return 0xFF00 + (charCode - 0x0020);
        }
        if (0x0020 === charCode) {
            return 0x3000;
        }
        return charCode;
    }
    FullHalfCore.toFullWidth = toFullWidth;
    function toHalfWidth(charCode) {
        if (0xFF00 < charCode && charCode < 0xFF5F) {
            return 0x0020 + (charCode - 0xFF00);
        }
        if (0x3000 === charCode) {
            return 0x0020;
        }
        return charCode;
    }
    FullHalfCore.toHalfWidth = toHalfWidth;
    function _optionsType(data) {
        if (data) {
            if (typeof data.exists == 'boolean') {
                for (let key in FullHalfCore.table[0]) {
                    if (key.indexOf('default') == 0) {
                        continue;
                    }
                    if (data[key] !== false) {
                        data[key] = data.exists;
                    }
                }
                delete data.exists;
            }
            else {
                if (typeof data.default == 'boolean') {
                    for (let key of FullHalfCore.tableDefaultInclude) {
                        if (data[key] !== false) {
                            data[key] = data.default;
                        }
                    }
                    delete data.default;
                }
                if (typeof data.not_default2 == 'boolean') {
                    data.both = data.space = data.not_default2;
                    delete data.not_default2;
                }
                if (typeof data.both == 'boolean') {
                    data.number = data.eng = data.both;
                    delete data.both;
                }
                if (typeof data.eng == 'boolean') {
                    data['a-z'] = data['A-Z'] = data.eng;
                    delete data.eng;
                }
            }
        }
        return data;
    }
    FullHalfCore._optionsType = _optionsType;
    function process(str, charProcess, options) {
        let ret = [];
        options.skip = _optionsType(options.skip);
        options.only = _optionsType(options.only);
        //console.log(options);
        let _str = Array.isArray(str) ? str : str.toString();
        for (let char of _str) {
            let _skip;
            // @ts-ignore
            let charCode = typeof char == 'number' ? char : char.charCodeAt();
            if (options.only) {
                _skip = true;
                for (let key in options.only) {
                    //console.log(char, charCode, [key], chkType(charCode, key, options.type));
                    if (options.only[key] && chkType(charCode, key, options.type)) {
                        _skip = false;
                        break;
                    }
                }
                //console.log(char, charCode, _skip);
            }
            if (!_skip && options.skip) {
                for (let key in options.skip) {
                    if (options.skip[key] && chkType(charCode, key, options.type)) {
                        _skip = true;
                        break;
                    }
                }
            }
            if (_skip) {
                ret.push(charCode);
                continue;
            }
            ret.push(charProcess(charCode));
        }
        if (options.returnType) {
            return ret;
        }
        return String.fromCharCode.apply(String, ret);
    }
    FullHalfCore.process = process;
    function factory(charProcessor, type, overwriteOptions) {
        //const deepmerge = require('deepmerge');
        return (str, options) => {
            options = deepmerge.all([
                {
                //skip: {},
                }, options || {}, overwriteOptions || {}, {
                    type: type,
                },
            ]);
            //console.log(options);
            return process(str, charProcessor, options);
        };
    }
    FullHalfCore.factory = factory;
})(FullHalfCore = exports.FullHalfCore || (exports.FullHalfCore = {}));
let typeOnly = {
    only: {
        number: true,
    },
};
exports.toFullNumber = FullHalfCore.factory(FullHalfCore.toFullWidth, FullHalfCore.FULL_WIDTH, typeOnly);
exports.toHalfNumber = FullHalfCore.factory(FullHalfCore.toHalfWidth, FullHalfCore.HALF_WIDTH, typeOnly);
typeOnly = {
    only: {
        eng: true,
    },
};
exports.toFullEnglish = FullHalfCore.factory(FullHalfCore.toFullWidth, FullHalfCore.FULL_WIDTH, typeOnly);
exports.toHalfEnglish = FullHalfCore.factory(FullHalfCore.toHalfWidth, FullHalfCore.HALF_WIDTH, typeOnly);
typeOnly = {
    only: {
        default: true,
    },
};
exports.toFullWidth = FullHalfCore.factory(FullHalfCore.toFullWidth, FullHalfCore.FULL_WIDTH, typeOnly);
exports.toHalfWidth = FullHalfCore.factory(FullHalfCore.toHalfWidth, FullHalfCore.HALF_WIDTH, typeOnly);
exports.default = exports;
//console.log(toFullEnglish('123abcABCＡＢＣ１２３／＊－＋＝－０］［’；／．+-*/=-09][\'";/.'));
//console.log(toHalfEnglish('123abcABCＡＢＣ１２３／＊－＋＝－０］［’；／．+-*/=-09][\'";/.'));
//console.log(toFullNumber('123abcABCＡＢＣ１２３／＊－＋＝－０］［’；／．+-*/=-09][\'";/.'));
//console.log(toHalfNumber('123abcABCＡＢＣ１２３／＊－＋＝－０］［’；／．+-*/=-09][\'";/.'));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnVsbGhhbGYuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJmdWxsaGFsZi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7O0dBRUc7O0FBRUgsdUNBQXdDO0FBQ3hDLCtCQUFnQztBQUVoQyxJQUFpQixZQUFZLENBdWY1QjtBQXZmRCxXQUFpQixZQUFZO0lBRWYsdUJBQVUsR0FBRyxDQUFDLENBQUM7SUFDZix1QkFBVSxHQUFHLENBQUMsQ0FBQztJQUVmLHFCQUFRLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFrRTNCOztPQUVHO0lBQ0gsSUFBSSxNQUFNLEdBQUc7UUFDWixPQUFPLEVBQUU7WUFDUixJQUFJLEVBQUUsTUFBTSxHQUFHLENBQUM7WUFDaEIsRUFBRSxFQUFFLE1BQU0sR0FBRyxDQUFDO1lBQ2QsTUFBTSxFQUFFLENBQUMsTUFBTSxDQUFDO1NBQ2hCO1FBRUQsTUFBTSxFQUFFLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQztRQUV4QixLQUFLLEVBQUUsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDO1FBQ3ZCLEtBQUssRUFBRSxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUM7UUFFdkIsS0FBSyxFQUFFLENBQUMsTUFBTSxDQUFDO1FBRWYsS0FBSyxFQUFFO1lBQ04sTUFBTSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDO1NBQzlCO1FBRUQsT0FBTyxFQUFFO1lBQ1IsTUFBTSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDO1NBQ2pDO0tBQ0QsQ0FBQztJQUVTLGdDQUFtQixHQUFHO1FBQ2hDLFFBQVE7UUFDUixLQUFLO1FBQ0wsS0FBSztRQUNMLE9BQU87UUFDUCxhQUFhO0tBQ2IsQ0FBQztJQUVTLGtCQUFLLEdBQWEsRUFBRSxDQUFDO0lBRWhDO1FBQ0MsSUFBSSxLQUFLLEdBQUcsYUFBQSxtQkFBbUIsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFN0MsYUFBQSxL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LEVBQUUsUUFBUSxDQUFDLENBQUM7QUFDekcsUUFBQSxZQUFZLEdBQUcsWUFBWSxDQUFDLE9BQU8sQ0FBUyxZQUFZLENBQUMsV0FBVyxFQUFFLFlBQVksQ0FBQyxVQUFVLEVBQUUsUUFBUSxDQUFDLENBQUM7QUFFdEgsUUFBUSxHQUFHO0lBQ1YsSUFBSSxFQUFFO1FBQ0wsR0FBRyxFQUFFLElBQUk7S0FDVDtDQUNELENBQUM7QUFFVyxRQUFBLGFBQWEsR0FBRyxZQUFZLENBQUMsT0FBTyxDQUFTLFlBQVksQ0FBQyxXQUFXLEVBQUUsWUFBWSxDQUFDLFVBQVUsRUFBRSxRQUFRLENBQUMsQ0FBQztBQUMxRyxRQUFBLGFBQWEsR0FBRyxZQUFZLENBQUMsT0FBTyxDQUFTLFlBQVksQ0FBQyxXQUFXLEVBQUUsWUFBWSxDQUFDLFVBQVUsRUFBRSxRQUFRLENBQUMsQ0FBQztBQUV2SCxRQUFRLEdBQUc7SUFDVixJQUFJLEVBQUU7UUFDTCxPQUFPLEVBQUUsSUFBSTtLQUNiO0NBQ0QsQ0FBQztBQUVXLFFBQUEsV0FBVyxHQUFHLFlBQVksQ0FBQyxPQUFPLENBQVMsWUFBWSxDQUFDLFdBQVcsRUFBRSxZQUFZLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0FBQ3hHLFFBQUEsV0FBVyxHQUFHLFlBQVksQ0FBQyxPQUFPLENBQVMsWUFBWSxDQUFDLFdBQVcsRUFBRSxZQUFZLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0FBRXJILGtCQUFlLE9BQXNDLENBQUM7QUFFdEQsNkVBQTZFO0FBQzdFLDZFQUE2RTtBQUM3RSw0RUFBNEU7QUFDNUUsNEVBQTRFIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDcmVhdGVkIGJ5IHVzZXIgb24gMjAxNy8xMi84LzAwOC5cbiAqL1xuXG5pbXBvcnQgZGVlcG1lcmdlID0gcmVxdWlyZSgnZGVlcG1lcmdlJyk7XG5pbXBvcnQgdXRpbCA9IHJlcXVpcmUoJy4vdXRpbCcpO1xuXG5leHBvcnQgbmFtZXNwYWNlIEZ1bGxIYWxmQ29yZVxue1xuXHRleHBvcnQgY29uc3QgRlVMTF9XSURUSCA9IDE7XG5cdGV4cG9ydCBjb25zdCBIQUxGX1dJRFRIID0gMDtcblxuXHRleHBvcnQgY29uc3QgTk9fRVhJU1QgPSAtMTtcblxuXHRleHBvcnQgaW50ZXJmYWNlIElPcHRpb25zVHlwZVxuXHR7XG5cdFx0ZW5nPzogYm9vbGVhbixcblx0XHRudW1iZXI/OiBib29sZWFuLFxuXG5cdFx0LyoqXG5cdFx0ICogZW5nICYgbnVtYmVyXG5cdFx0ICovXG5cdFx0Ym90aD86IGJvb2xlYW47XG5cblx0XHRzcGFjZT86IGJvb2xlYW47XG5cdFx0ZXhpc3RzPzogYm9vbGVhbjtcblxuXHRcdGRlZmF1bHQ/OiBib29sZWFuO1xuXHRcdG5vdF9kZWZhdWx0PzogYm9vbGVhbjtcblx0XHRub3RfZGVmYXVsdDI/OiBib29sZWFuO1xuXG5cdFx0c2xhc2g/OiBib29sZWFuO1xuXHRcdGJyYWNrZXQ/OiBib29sZWFuO1xuXG5cdFx0W2luZGV4OiBzdHJpbmddOiBib29sZWFuO1xuXHR9XG5cblx0ZXhwb3J0IGludGVyZmFjZSBJT3B0aW9uc1xuXHR7XG5cdFx0dHlwZT86IG51bWJlcjtcblxuXHRcdHNraXA/OiBJT3B0aW9uc1R5cGU7XG5cdFx0b25seT86IElPcHRpb25zVHlwZTtcblxuXHRcdG1vZGU/OiB7XG5cdFx0XHRvbmx5PzogYm9vbGVhbixcblxuXHRcdFx0W2luZGV4OiBzdHJpbmddOiBib29sZWFuO1xuXHRcdH07XG5cblx0XHRyZXR1cm5UeXBlPzogbnVtYmVyO1xuXHR9XG5cblx0ZXhwb3J0IGludGVyZmFjZSBJVGFibGVPYmplY3Rcblx0e1xuXHRcdGZyb20/OiBudW1iZXI7XG5cdFx0dG8/OiBudW1iZXI7XG5cblx0XHR2YWx1ZXM/OiBudW1iZXJbXTtcblxuXHRcdG5vdD86IElUYWJsZU9iamVjdFtdLFxuXHR9XG5cblx0ZXhwb3J0IGludGVyZmFjZSBJVGFibGVcblx0e1xuXHRcdGRlZmF1bHQ/OiBJVGFibGVPYmplY3Q7XG5cblx0XHRudW1iZXI/OiBJVGFibGVPYmplY3Q7XG5cdFx0c3BhY2U/OiBJVGFibGVPYmplY3Q7XG5cblx0XHQnQS1aJz86IElUYWJsZU9iamVjdDtcblx0XHQnYS16Jz86IElUYWJsZU9iamVjdDtcblxuXHRcdG5vdF9kZWZhdWx0PzogSVRhYmxlT2JqZWN0O1xuXG5cdFx0W2luZGV4OiBzdHJpbmddOiBJVGFibGVPYmplY3Q7XG5cdH1cblxuXHQvKipcblx0ICogQHNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Db2RlX3BhZ2VfNDM3XG5cdCAqL1xuXHRsZXQgX3RhYmxlID0ge1xuXHRcdGRlZmF1bHQ6IHtcblx0XHRcdGZyb206IDB4MDAyMCArIDEsXG5cdFx0XHR0bzogMHgwMDdGIC0gMSxcblx0XHRcdHZhbHVlczogWzB4MDAyMF0sXG5cdFx0fSxcblxuXHRcdG51bWJlcjogWzB4MDAzMCwgMHgwMDM5XSxcblxuXHRcdCdBLVonOiBbMHgwMDQxLCAweDAwNUFdLFxuXHRcdCdhLXonOiBbMHgwMDYxLCAweDAwN0FdLFxuXG5cdFx0c3BhY2U6IFsweDAwMjBdLFxuXG5cdFx0c2xhc2g6IHtcblx0XHRcdHZhbHVlczogdXRpbC5jaGFyQ29kZUF0KGAvXFxcXGApLFxuXHRcdH0sXG5cblx0XHRicmFja2V0OiB7XG5cdFx0XHR2YWx1ZXM6IHV0aWwuY2hhckNvZGVBdChgKClbXXt9YCksXG5cdFx0fSxcblx0fTtcblxuXHRleHBvcnQgbGV0IHRhYmxlRGVmYXVsdEluY2x1ZGUgPSBbXG5cdFx0J251bWJlcicsXG5cdFx0J0EtWicsXG5cdFx0J2EteicsXG5cdFx0J3NwYWNlJyxcblx0XHQnbm90X2RlZmF1bHQnLFxuXHRdO1xuXG5cdGV4cG9ydCBsZXQgdGFibGU6IElUYWJsZVtdID0gW107XG5cblx0e1xuXHRcdGxldCBfa2V5cyA9IHRhYmxlRGVmYXVsdEluY2x1ZGUuc2xpY2UoMCwgLTEpO1xuXG5cdFx0dGFibGVbMF0gPSB7fTtcblx0XHR0YWJsZVsxXSA9IHt9O1xuXG5cdFx0Zm9yIChsZXQgayBpbiBfdGFibGUpXG5cdFx0e1xuXHRcdFx0bGV0IHYgPSBfdGFibGVba107XG5cblx0XHRcdGxldCByO1xuXG5cdFx0XHRyID0gZm4odik7XG5cblx0XHRcdGlmIChyKVxuXHRcdFx0e1xuXHRcdFx0XHR0YWJsZVtIQUxGX1dJRFRIXVtrXSA9IHJbMV07XG5cdFx0XHRcdHRhYmxlW0ZVTExfV0lEVEhdW2tdID0gclswXTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRsZXQgciA9IGZuKF90YWJsZS5kZWZhdWx0KTtcblxuXHRcdHJbMF0ubm90ID0gW107XG5cdFx0clsxXS5ub3QgPSBbXTtcblxuXHRcdGZvciAobGV0IGsgb2YgX2tleXMpXG5cdFx0e1xuXHRcdFx0bGV0IHYgPSBfdGFibGVba107XG5cblx0XHRcdGxldCByMjtcblxuXHRcdFx0cjIgPSBmbih2KTtcblxuXHRcdFx0aWYgKHIyKVxuXHRcdFx0e1xuXHRcdFx0XHRyWzBdLm5vdC5wdXNoKHIyWzBdKTtcblx0XHRcdFx0clsxXS5ub3QucHVzaChyMlsxXSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0dGFibGVbSEFMRl9XSURUSF1bJ25vdF9kZWZhdWx0J10gPSByWzFdO1xuXHRcdHRhYmxlW0ZVTExfV0lEVEhdWydub3RfZGVmYXVsdCddID0gclswXTtcblxuXHRcdC8vY29uc29sZS5sb2codGFibGUpO1xuXG5cdFx0ZnVuY3Rpb24gZm4odilcblx0XHR7XG5cdFx0XHRsZXQgcjogSVRhYmxlT2JqZWN0W10gPSBbXTtcblxuXHRcdFx0clswXSA9IHt9O1xuXHRcdFx0clsxXSA9IHt9O1xuXG5cdFx0XHRsZXQgX3NraXAgPSB0cnVlO1xuXG5cdFx0XHRpZiAoQXJyYXkuaXNBcnJheSh2KSlcblx0XHRcdHtcblx0XHRcdFx0aWYgKHYubGVuZ3RoID09IDIpXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRyWzBdLmZyb20gPSB2WzBdO1xuXHRcdFx0XHRcdHJbMF0udG8gPSB2WzFdO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGVsc2Vcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHJbMF0udmFsdWVzID0gdjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdF9za2lwID0gZmFsc2U7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh2LmZyb20gJiYgdi50bylcblx0XHRcdHtcblx0XHRcdFx0clswXS5mcm9tID0gdi5mcm9tO1xuXHRcdFx0XHRyWzBdLnRvID0gdi50bztcblxuXHRcdFx0XHRfc2tpcCA9IGZhbHNlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoQXJyYXkuaXNBcnJheSh2LnZhbHVlcykgJiYgdi52YWx1ZXMubGVuZ3RoKVxuXHRcdFx0e1xuXHRcdFx0XHRyWzBdLnZhbHVlcyA9IHYudmFsdWVzO1xuXG5cdFx0XHRcdF9za2lwID0gZmFsc2U7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfc2tpcClcblx0XHRcdHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoclswXS5mcm9tICYmIHJbMF0udG8pXG5cdFx0XHR7XG5cdFx0XHRcdHJbMV0uZnJvbSA9IHRvRnVsbFdpZHRoKHJbMF0uZnJvbSk7XG5cdFx0XHRcdHJbMV0udG8gPSB0b0Z1bGxXaWR0aChyWzBdLnRvKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHJbMF0udmFsdWVzKVxuXHRcdFx0e1xuXHRcdFx0XHRyWzFdLnZhbHVlcyA9IChyWzBdLnZhbHVlcyBhcyBudW1iZXJbXSkucmVkdWNlKGZ1bmN0aW9uIChhLCBjb2RlKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0YS5wdXNoKHRvRnVsbFdpZHRoKGNvZGUpKTtcblxuXHRcdFx0XHRcdHJldHVybiBhO1xuXHRcdFx0XHR9LCBbXSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiByO1xuXHRcdH1cblx0fVxuXG5cdGV4cG9ydCBmdW5jdGlvbiBmaWx0ZXJUYWJsZShkYXRhKVxuXHR7XG5cdFx0bGV0IF9hID0gW107XG5cblx0XHRpZiAoZGF0YS5mcm9tICYmIGRhdGEudG8pXG5cdFx0e1xuXHRcdFx0Zm9yIChsZXQgaSA9IGRhdGEuZnJvbTsgaTw9ZGF0YS50bzsgaSsrKVxuXHRcdFx0e1xuXHRcdFx0XHRfYS5wdXNoKGkpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChkYXRhLnZhbHVlcylcblx0XHR7XG5cdFx0XHRfYSA9IF9hLmNvbmNhdChkYXRhLnZhbHVlcylcblx0XHR9XG5cblx0XHRpZiAoQXJyYXkuaXNBcnJheShkYXRhLm5vdCkgJiYgZGF0YS5ub3QubGVuZ3RoKVxuXHRcdHtcblx0XHRcdF9hID0gX2EuZmlsdGVyKGZ1bmN0aW9uIChjaGFyQ29kZSlcblx0XHRcdHtcblx0XHRcdFx0Zm9yIChsZXQgZCBvZiBkYXRhLm5vdClcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGlmIChfY2hrVHlwZShjaGFyQ29kZSwgZCkpXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIF9hO1xuXHR9XG5cblx0ZXhwb3J0IGZ1bmN0aW9uIF9jaGtUeXBlKGNoYXJDb2RlOiBudW1iZXIsIGRhdGE6IElUYWJsZU9iamVjdClcblx0e1xuXHRcdGlmIChkYXRhLmZyb20gJiYgZGF0YS50byAmJiBkYXRhLmZyb20gPD0gY2hhckNvZGUgJiYgY2hhckNvZGUgPD0gZGF0YS50bylcblx0XHR7XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cdFx0ZWxzZSBpZiAoZGF0YS52YWx1ZXMgJiYgZGF0YS52YWx1ZXMuaW5jbHVkZXMoY2hhckNvZGUpKVxuXHRcdHtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1cblx0fVxuXG5cdGV4cG9ydCBmdW5jdGlvbiBjaGtUeXBlKGNoYXJDb2RlOiBudW1iZXIsIGtleTogc3RyaW5nLCB0eXBlOiBudW1iZXIpXG5cdHtcblx0XHRsZXQgZGF0YSA9IHRhYmxlW3R5cGVdW2tleV07XG5cblx0XHQvL2NvbnNvbGUubG9nKGNoYXJDb2RlLCBkYXRhKTtcblxuXHRcdGlmIChBcnJheS5pc0FycmF5KGRhdGEubm90KSAmJiBkYXRhLm5vdC5sZW5ndGgpXG5cdFx0e1xuXHRcdFx0Zm9yIChsZXQgZCBvZiBkYXRhLm5vdClcblx0XHRcdHtcblx0XHRcdFx0aWYgKF9jaGtUeXBlKGNoYXJDb2RlLCBkKSlcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChfY2hrVHlwZShjaGFyQ29kZSwgZGF0YSkpXG5cdFx0e1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXHR9XG5cblx0ZXhwb3J0IGZ1bmN0aW9uIGhhc0Z1bGxIYWxmKGNoYXJDb2RlOiBudW1iZXIpXG5cdHtcblx0XHRpZiAoMHgwMDIwIDw9IGNoYXJDb2RlICYmIGNoYXJDb2RlIDwgMHgwMDdGKVxuXHRcdHtcblx0XHRcdHJldHVybiBIQUxGX1dJRFRIO1xuXHRcdH1cblxuXHRcdGlmICgweDMwMDAgPT09IGNoYXJDb2RlIHx8IDB4RkYwMCA8IGNoYXJDb2RlICYmIGNoYXJDb2RlIDwgMHhGRjVGKVxuXHRcdHtcblx0XHRcdHJldHVybiBGVUxMX1dJRFRIO1xuXHRcdH1cblxuXHRcdHJldHVybiBOT19FWElTVDtcblx0fVxuXG5cdGV4cG9ydCBmdW5jdGlvbiBpc0Z1bGxIYWxmKGNoYXJDb2RlOiBudW1iZXIpXG5cdHtcblx0XHRsZXQgciA9IGhhc0Z1bGxIYWxmKGNoYXJDb2RlKTtcblxuXHRcdGlmIChyID09PSBGVUxMX1dJRFRIKVxuXHRcdHtcblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH1cblx0XHRlbHNlIGlmIChyID09PSBIQUxGX1dJRFRIKVxuXHRcdHtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cdFx0ZWxzZVxuXHRcdHtcblx0XHRcdC8vIEB0b2RvIGFkZCBtb3JlLi4uXG5cdFx0fVxuXG5cdFx0cmV0dXJuIG51bGw7XG5cdH1cblxuXHRleHBvcnQgZnVuY3Rpb24gdG9GdWxsV2lkdGgoY2hhckNvZGU6IG51bWJlcilcblx0e1xuXHRcdGlmICgweDAwMjAgPCBjaGFyQ29kZSAmJiBjaGFyQ29kZSA8IDB4MDA3Rilcblx0XHR7XG5cdFx0XHRyZXR1cm4gMHhGRjAwICsgKGNoYXJDb2RlIC0gMHgwMDIwKTtcblx0XHR9XG5cblx0XHRpZiAoMHgwMDIwID09PSBjaGFyQ29kZSlcblx0XHR7XG5cdFx0XHRyZXR1cm4gMHgzMDAwO1xuXHRcdH1cblxuXHRcdHJldHVybiBjaGFyQ29kZTtcblx0fVxuXG5cdGV4cG9ydCBmdW5jdGlvbiB0b0hhbGZXaWR0aChjaGFyQ29kZTogbnVtYmVyKVxuXHR7XG5cdFx0aWYgKDB4RkYwMCA8IGNoYXJDb2RlICYmIGNoYXJDb2RlIDwgMHhGRjVGKVxuXHRcdHtcblx0XHRcdHJldHVybiAweDAwMjAgKyAoY2hhckNvZGUgLSAweEZGMDApO1xuXHRcdH1cblxuXHRcdGlmICgweDMwMDAgPT09IGNoYXJDb2RlKVxuXHRcdHtcblx0XHRcdHJldHVybiAweDAwMjA7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGNoYXJDb2RlO1xuXHR9XG5cblx0ZXhwb3J0IGZ1bmN0aW9uIF9vcHRpb25zVHlwZShkYXRhOiBJT3B0aW9uc1R5cGUpXG5cdHtcblx0XHRpZiAoZGF0YSlcblx0XHR7XG5cdFx0XHRpZiAodHlwZW9mIGRhdGEuZXhpc3RzID09ICdib29sZWFuJylcblx0XHRcdHtcblx0XHRcdFx0Zm9yIChsZXQga2V5IGluIHRhYmxlWzBdKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0aWYgKGtleS5pbmRleE9mKCdkZWZhdWx0JykgPT0gMClcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoZGF0YVtrZXldICE9PSBmYWxzZSlcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRkYXRhW2tleV0gPSBkYXRhLmV4aXN0cztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRkZWxldGUgZGF0YS5leGlzdHM7XG5cdFx0XHR9XG5cdFx0XHRlbHNlXG5cdFx0XHR7XG5cdFx0XHRcdGlmICh0eXBlb2YgZGF0YS5kZWZhdWx0ID09ICdib29sZWFuJylcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGZvciAobGV0IGtleSBvZiB0YWJsZURlZmF1bHRJbmNsdWRlKVxuXHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdGlmIChkYXRhW2tleV0gIT09IGZhbHNlKVxuXHRcdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0XHRkYXRhW2tleV0gPSBkYXRhLmRlZmF1bHQ7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0ZGVsZXRlIGRhdGEuZGVmYXVsdDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2YgZGF0YS5ub3RfZGVmYXVsdDIgPT0gJ2Jvb2xlYW4nKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0ZGF0YS5ib3RoID0gZGF0YS5zcGFjZSA9IGRhdGEubm90X2RlZmF1bHQyO1xuXHRcdFx0XHRcdGRlbGV0ZSBkYXRhLm5vdF9kZWZhdWx0Mjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2YgZGF0YS5ib3RoID09ICdib29sZWFuJylcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGRhdGEubnVtYmVyID0gZGF0YS5lbmcgPSBkYXRhLmJvdGg7XG5cdFx0XHRcdFx0ZGVsZXRlIGRhdGEuYm90aDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2YgZGF0YS5lbmcgPT0gJ2Jvb2xlYW4nKVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0ZGF0YVsnYS16J10gPSBkYXRhWydBLVonXSA9IGRhdGEuZW5nO1xuXHRcdFx0XHRcdGRlbGV0ZSBkYXRhLmVuZztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBkYXRhO1xuXHR9XG5cblx0ZXhwb3J0IGZ1bmN0aW9uIHByb2Nlc3M8VCwgVSA9IHN0cmluZz4oc3RyLCBjaGFyUHJvY2Vzcywgb3B0aW9uczogSU9wdGlvbnMpXG5cdHtcblx0XHRsZXQgcmV0OiBudW1iZXJbXSA9IFtdO1xuXG5cdFx0b3B0aW9ucy5za2lwID0gX29wdGlvbnNUeXBlKG9wdGlvbnMuc2tpcCk7XG5cdFx0b3B0aW9ucy5vbmx5ID0gX29wdGlvbnNUeXBlKG9wdGlvbnMub25seSk7XG5cblx0XHQvL2NvbnNvbGUubG9nKG9wdGlvbnMpO1xuXG5cdFx0bGV0IF9zdHIgPSBBcnJheS5pc0FycmF5KHN0cikgPyBzdHIgOiBzdHIudG9TdHJpbmcoKTtcblxuXHRcdGZvciAobGV0IGNoYXIgb2YgX3N0cilcblx0XHR7XG5cdFx0XHRsZXQgX3NraXA6IGJvb2xlYW47XG5cblx0XHRcdC8vIEB0cy1pZ25vcmVcblx0XHRcdGxldCBjaGFyQ29kZSA9IHR5cGVvZiBjaGFyID09ICdudW1iZXInID8gY2hhciA6IGNoYXIuY2hhckNvZGVBdCgpO1xuXG5cdFx0XHRpZiAob3B0aW9ucy5vbmx5KVxuXHRcdFx0e1xuXHRcdFx0XHRfc2tpcCA9IHRydWU7XG5cblx0XHRcdFx0Zm9yIChsZXQga2V5IGluIG9wdGlvbnMub25seSlcblx0XHRcdFx0e1xuXHRcdFx0XHRcdC8vY29uc29sZS5sb2coY2hhciwgY2hhckNvZGUsIFtrZXldLCBjaGtUeXBlKGNoYXJDb2RlLCBrZXksIG9wdGlvbnMudHlwZSkpO1xuXG5cdFx0XHRcdFx0aWYgKG9wdGlvbnMub25seVtrZXldICYmIGNoa1R5cGUoY2hhckNvZGUsIGtleSwgb3B0aW9ucy50eXBlKSlcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRfc2tpcCA9IGZhbHNlO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly9jb25zb2xlLmxvZyhjaGFyLCBjaGFyQ29kZSwgX3NraXApO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIV9za2lwICYmIG9wdGlvbnMuc2tpcClcblx0XHRcdHtcblx0XHRcdFx0Zm9yIChsZXQga2V5IGluIG9wdGlvbnMuc2tpcClcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGlmIChvcHRpb25zLnNraXBba2V5XSAmJiBjaGtUeXBlKGNoYXJDb2RlLCBrZXksIG9wdGlvbnMudHlwZSkpXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0X3NraXAgPSB0cnVlO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmIChfc2tpcClcblx0XHRcdHtcblx0XHRcdFx0cmV0LnB1c2goY2hhckNvZGUpO1xuXHRcdFx0XHRjb250aW51ZTtcblx0XHRcdH1cblxuXHRcdFx0cmV0LnB1c2goY2hhclByb2Nlc3MoY2hhckNvZGUpKTtcblx0XHR9XG5cblx0XHRpZiAob3B0aW9ucy5yZXR1cm5UeXBlKVxuXHRcdHtcblx0XHRcdHJldHVybiByZXQgYXMgbnVtYmVyW107XG5cdFx0fVxuXG5cdFx0cmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkoU3RyaW5nLCByZXQpO1xuXHR9XG5cblx0ZXhwb3J0IGZ1bmN0aW9uIGZhY3Rvcnk8VCA9IHN0cmluZz4oY2hhclByb2Nlc3NvciwgdHlwZTogbnVtYmVyLCBvdmVyd3JpdGVPcHRpb25zPzogSU9wdGlvbnMpOiBJRmFjdG9yeUZuXG5cdHtcblx0XHQvL2NvbnN0IGRlZXBtZXJnZSA9IHJlcXVpcmUoJ2RlZXBtZXJnZScpO1xuXG5cdFx0cmV0dXJuIChzdHIsIG9wdGlvbnM/OiBJT3B0aW9ucykgPT5cblx0XHR7XG5cdFx0XHRvcHRpb25zID0gZGVlcG1lcmdlLmFsbChbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHQvL3NraXA6IHt9LFxuXHRcdFx0XHR9LCBvcHRpb25zIHx8IHt9LCBvdmVyd3JpdGVPcHRpb25zIHx8IHt9LCB7XG5cdFx0XHRcdFx0dHlwZTogdHlwZSxcblx0XHRcdFx0fSxcblx0XHRcdF0pO1xuXG5cdFx0XHQvL2NvbnNvbGUubG9nKG9wdGlvbnMpO1xuXG5cdFx0XHRyZXR1cm4gcHJvY2VzczxUPihzdHIsIGNoYXJQcm9jZXNzb3IsIG9wdGlvbnMpO1xuXHRcdH07XG5cdH1cblxuXHRleHBvcnQgaW50ZXJmYWNlIElGYWN0b3J5Rm5cblx0e1xuXHRcdChzdHI6IHN0cmluZywgb3B0aW9ucz86IElPcHRpb25zKTogc3RyaW5nXG5cdFx0KHN0cjogbnVtYmVyLCBvcHRpb25zPzogSU9wdGlvbnMpOiBzdHJpbmdcblx0XHQoc3RyLCBvcHRpb25zPzogSU9wdGlvbnMpXG5cdH1cbn1cblxubGV0IHR5cGVPbmx5OiBGdWxsSGFsZkNvcmUuSU9wdGlvbnMgPSB7XG5cdG9ubHk6IHtcblx0XHRudW1iZXI6IHRydWUsXG5cdH0sXG59O1xuXG5leHBvcnQgY29uc3QgdG9GdWxsTnVtYmVyID0gRnVsbEhhbGZDb3JlLmZhY3Rvcnk8c3RyaW5nPihGdWxsSGFsZkNvcmUudG9GdWxsV2lkdGgsIEZ1bGxIYWxmQ29yZS5GVUxMX1dJRFRILCB0eXBlT25seSk7XG5leHBvcnQgY29uc3QgdG9IYWxmTnVtYmVyID0gRnVsbEhhbGZDb3JlLmZhY3Rvcnk8c3RyaW5nPihGdWxsSGFsZkNvcmUudG9IYWxmV2lkdGgsIEZ1bGxIYWxmQ29yZS5IQUxGX1dJRFRILCB0eXBlT25seSk7XG5cbnR5cGVPbmx5ID0ge1xuXHRvbmx5OiB7XG5cdFx0ZW5nOiB0cnVlLFxuXHR9LFxufTtcblxuZXhwb3J0IGNvbnN0IHRvRnVsbEVuZ2xpc2ggPSBGdWxsSGFsZkNvcmUuZmFjdG9yeTxzdHJpbmc+KEZ1bGxIYWxmQ29yZS50b0Z1bGxXaWR0aCwgRnVsbEhhbGZDb3JlLkZVTExfV0lEVEgsIHR5cGVPbmx5KTtcbmV4cG9ydCBjb25zdCB0b0hhbGZFbmdsaXNoID0gRnVsbEhhbGZDb3JlLmZhY3Rvcnk8c3RyaW5nPihGdWxsSGFsZkNvcmUudG9IYWxmV2lkdGgsIEZ1bGxIYWxmQ29yZS5IQUxGX1dJRFRILCB0eXBlT25seSk7XG5cbnR5cGVPbmx5ID0ge1xuXHRvbmx5OiB7XG5cdFx0ZGVmYXVsdDogdHJ1ZSxcblx0fSxcbn07XG5cbmV4cG9ydCBjb25zdCB0b0Z1bGxXaWR0aCA9IEZ1bGxIYWxmQ29yZS5mYWN0b3J5PHN0cmluZz4oRnVsbEhhbGZDb3JlLnRvRnVsbFdpZHRoLCBGdWxsSGFsZkNvcmUuRlVMTF9XSURUSCwgdHlwZU9ubHkpO1xuZXhwb3J0IGNvbnN0IHRvSGFsZldpZHRoID0gRnVsbEhhbGZDb3JlLmZhY3Rvcnk8c3RyaW5nPihGdWxsSGFsZkNvcmUudG9IYWxmV2lkdGgsIEZ1bGxIYWxmQ29yZS5IQUxGX1dJRFRILCB0eXBlT25seSk7XG5cbmV4cG9ydCBkZWZhdWx0IGV4cG9ydHMgYXMgdHlwZW9mIGltcG9ydCgnLi9mdWxsaGFsZicpO1xuXG4vL2NvbnNvbGUubG9nKHRvRnVsbEVuZ2xpc2goJzEyM2FiY0FCQ++8oe+8ou+8o++8ke+8ku+8k++8j++8iu+8je+8i++8ne+8je+8kO+8ve+8u+KAme+8m++8j++8jistKi89LTA5XVtcXCdcIjsvLicpKTtcbi8vY29uc29sZS5sb2codG9IYWxmRW5nbGlzaCgnMTIzYWJjQUJD77yh77yi77yj77yR77yS77yT77yP77yK77yN77yL77yd77yN77yQ77y977y74oCZ77yb77yP77yOKy0qLz0tMDldW1xcJ1wiOy8uJykpO1xuLy9jb25zb2xlLmxvZyh0b0Z1bGxOdW1iZXIoJzEyM2FiY0FCQ++8oe+8ou+8o++8ke+8ku+8k++8j++8iu+8je+8i++8ne+8je+8kO+8ve+8u+KAme+8m++8j++8jistKi89LTA5XVtcXCdcIjsvLicpKTtcbi8vY29uc29sZS5sb2codG9IYWxmTnVtYmVyKCcxMjNhYmNBQkPvvKHvvKLvvKPvvJHvvJLvvJPvvI/vvIrvvI3vvIvvvJ3vvI3vvJDvvL3vvLvigJnvvJvvvI/vvI4rLSovPS0wOV1bXFwnXCI7Ly4nKSk7XG4iXX0=